!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define("SoftBtn",["jquery"],t):n.SoftBtn=t()}(this,function(){"use strict";function n(n,t){return n in t}function t(t,e){if(n("forEach",Array))return t.forEach(e);for(var r=t.slice(),o=0;o<r.length;o++){if(!1===e(r[o],o,r))break}}function e(t,e,r){if(void 0===r&&(r=undefined),n("reduce",t))return t.reduce(e,r);for(var o=t.slice(),i=void 0===r?1:0,a=1===i?o[0]:r,u=i;u<o.length;u++)a=e(a,o[u],u,o);return a}function r(t,e){if(n("map",t))return t.map(e);for(var r=t.slice(),o=[],i=0;i<r.length;i++)o.push(e(r[i],i,r));return o}function o(t,e){if(n("every",t))return t.every(e);for(var r=t.slice(),o=!0,i=0;i<r.length;i++)if(!e(r[i],i,r)){o=!1;break}return o}function i(t,e){if(n("some",t))return t.some(e);for(var r=t.slice(),o=!1,i=0;i<r.length;i++)if(e(r[i],i,r)){o=!0;break}return o}function a(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=n.slice(),o=r[0].apply(r,t),i=1;i<r.length;i++)o=r[i](o);return o}}function u(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return n.apply(void 0,e.concat(t))}}function c(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.apply(void 0,t.reverse())}}function f(n,t){for(var e in n){if(!1===t(n[e],e,n))break}}function l(t,e){var r=h(t);if(n("map",r))return r.map(e);var o={};for(var i in r)o[i]=e(r[i],i,r);return o}function s(n){return"[object Array]"===Object.prototype.toString.call(n)}function d(n){return"function"==typeof n}function p(n){return!!n&&("[object Object]"===Object.prototype.toString.call(n)&&n instanceof Object)}function h(n,t){return void 0===t&&(t={}),p(n)||s(n)?(f(n,function(n,e){if(p(n))t[e]=h(n,t[e]||{});else if(s(n)){var o=r(n,function(n){return h(n)});t[e]=o}else d(n)?t[e]=n:n!==undefined&&(t[e]=n)}),t):n}function v(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e(t,function(n,t){return h(t,n)},n)}function g(n,t){void 0===t&&(t=n.length);var e=t||n.length;return function r(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return t.length<e?function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return r.apply(void 0,t.concat(n))}:n.apply(void 0,t)}}function m(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];X(function(t){Y(function(t,e){n[e]=t},t)},t)}function y(n){if(!p(n))return"";var t=[];return Y(function(n,e){var r=b(n);t.push(['"'+e+'"','"'+r+'"'].join(":"))},n),"{"+t.join(",")+"}"}function w(n){return s(n)?"["+L(b,n).join(",")+"]":""}function b(n){return p(n)?y(n):s(n)?w(n):String(n)}function S(n,t){return void 0===t&&(t={}),n.replace(fn,function(n,e){var r=cn(e.split("."),t);return r===undefined?"":p(r)?b(r):r})}function I(n){return s(n)?n:[n]}function k(n){for(var t=["byte","KB","MB","GB","TB"],e=0,r=+n;r>1024;)r/=1024,e++;return r.toFixed(1)+t[e]}function x(n){var t=+n,e=new Date(1e3*t);return e.getFullYear()+"-"+M(e.getMonth()+1)+"-"+M(e.getDate())}function C(n){var t=n.indexOf("http://");return n=n.slice(t).split("|||")[0]}function A(n){var t=["WinXp","Win2003","Vista","Win7","Win8","Win8.1","Win10"],e=r(n,function(n){return t[+n-1]}),o=e.pop();return o&&e.push(o),e.join("/")}function B(n){return{1:"\u6536\u8d39",2:"\u514d\u8d39"}[+n]}function M(n){return n<10?"0"+n:""+n}function E(n){switch(typeof n){case"number":return n+"px";case"string":return n.replace(/px$/,"")+"px";default:window.console&&console.log("cannot use addPx since the type is wrong: "+n)}}function j(){window.console&&console.log(dn)}function D(n){return function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var o;return t in n?(o=n[t])[gn()?"ie":"chrome"].apply(o,e):e}}function F(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];window.console&&console.log(n.join(" "))}function T(n){return n in(gn()?N():W())}function O(){return document.getElementById("smplugin")}function z(){return document.getElementById("chromeplugin")}function N(){var n=V();return H(n,[{name:"Call360App",method:R},{name:"IsSafeInstalled",method:G},{name:"IsSoftMgrInstalled",method:q}]),n}function V(){var n=O();return n||(n=_("object",{id:"smplugin",classid:"clsid:467B32FF-C688-40FF-95FC-C7C61247B0AA"}),P(n)),n}function W(){var n=z();return n||(n=_("embed",{id:"chromeplugin",type:"application/360softmgrplugin",objname:"simples"}),P(n)),n}function _(n,t){var e=document.createElement(n);for(var r in t){var o=t[r];e[r]=o,e.setAttribute(r,o)}return e}function P(n){var t=document.createElement("div");t.style.cssText="position:absolute;left:-99999px;top:-99px;visibility:hidden;",t.appendChild(n),document.body.appendChild(t)}function R(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e,r;try{return(e=window.wdextcmd).Call360Safe.apply(e,n),!0}catch(o){try{return(r=window.wdextcmd).Call360Login.apply(r,n),!0}catch(o){throw new Error("fail to invoke 360 safe under IE")}}}function G(){try{return N().GetVersion(),!0}catch(n){return!1}}function q(){try{var n=N().GetSoftMgrFileVersion();return n&&n.indexOf(".")>-1&&"5"!==n.split(".")[0]}catch(t){return!1}}function H(n,t){for(var e=0,r=t;e<r.length;e++){var o=r[e],i=o.name,a=o.method;i in n||(n[i]=a)}}function U(n){var t=vn.getData(n);if(tn("download-link",t))return window.location.href=Z("download-link",t);var e=function(t){if(0==t.errno){a(a(Z("p2p"),C,nn({},"download-link")),vn.setData(n))(t),window.location.href=a(vn.getData,Z("download-link"))(n)}};sn.fetchSoft(I(n)).then(function(n){e(n)})}function K(n,t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var r=gn(),o=r?V():W(),i=r?"ie":"chrome",a=mn.download[i],u=yn.download[i](n,t,e);try{o[a](u)}catch(c){return"fail"}}var L=g(c(r),2),X=g(c(t),2),Y=g(c(f),2),J=(g(c(e),2),g(c(o),2)),Q=(g(c(i),2),g(c(l),2)),Z=g(function(n,t){var e,r=0;try{Y(function i(t,o,a){if(r++>1e3)throw new Error("pick over limit: 1000");if(n in a)return e=a[n],!1;p(t)&&Y(i,t)},t)}catch(o){window.console&&console.log(o,"pick not found: "+n)}return e},2),nn=g(function(n,t,e){var r=h(n);return r[t]=e,r},3),tn=g(function(n,t){return!!p(t)&&Z(n,t)!==undefined},2),en=(g(function(n,t){return window.console&&console.log(n,t),t},2),g(function(n,t){return t.map(n).join()},2),g(function(n,t,e){return t.map(n).ap(e)},3)),rn=g(function(n,t,e,r){return t.map(n).ap(e).ap(r)},4),on=(g(function(n,t,e,r,o){return t.map(n).ap(e).ap(r).ap(o)},5),g(function(n){return e(n,function(n,t){return J(function(n){return n!=t},n)&&n.push(t),n},[])},1)),an=g(function(n){return a(on,L(un))(n).join(",")},1),un=g(function(n){return"["+n+',"",1]'},1),cn=g(function(n,t){return e(n,function(n,t){return n[t]},t)},2),fn=/{{(.*?)}}/g,ln=g(function(n,t){return s(t)?n<=t.length-1?t[n]:t[t.length-1]:t},2),sn={fetchSoft:function(n){var t=/^http/.test(location.protocol)?location.protocol:"http:";return a(an,function(n){return t+"//cx.soft.360.cn/soft/getinfo?info=["+n+"]"},function(n){return $.ajax({url:n,dataType:"jsonp"})})(n)}},dn={},pn=g(function(n,t){p(t)?dn[n]=tn(n,dn)?v({},hn(n),t):h(t):dn[n]=h(t)},2),hn=g(function(n){return dn[n]}),vn={setData:pn,getData:hn,logData:j},gn=function(){var n=!1;return function(){return(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(n=!0),gn=function(){return n},n}}(),mn={download:{ie:"CallSoftMgrWithParam",chrome:"CallSoftMgrWithParam"}},yn={download:{ie:function(n,t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),"/page=12&/DownloadSoft="+n+"&/protocolKeyName=&/start=360baokusoft"+(e?"":"&/New=1")+(t?"&/S=1":"")},chrome:function(n,t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),"/DOWNLOAD="+n+(e?"":" /New=1")+(t?" /S=1":"")}}},wn=function(){var n=gn();return function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if("unknown"!==t&&t||F((n?"IE":"Not IE")+" environment, and invalid method: "+t),n){var o=N();if("function"==typeof o[t])return o[t].apply(o,e);switch(e.length){case 0:return o[t]();case 1:return o[t](e[0]);case 2:return o[t](e[0],e[1]);case 3:return o[t](e[0],e[1],e[2]);default:throw F("In IE and "+e.length+" arguments have been passed in, which exceeds expectation!"),new Error("Exceeding Arguments")}}var i=W();return i[t].apply(i,e)}}(),bn=function(n,t){void 0===t&&(t=!1),"fail"===K(n,t)?(U(n),bn=U):bn=K},Sn=function(){function n(n){this.__value=n}return n.prototype.map=function(n){return this},n.of=function(t){return new n(t)},n}(),In=function(){function n(n){this.__value=n}return n.prototype.map=function(t){return n.of(t(this.__value))},n.of=function(t){return new n(t)},n}(),kn=function(){function n(n){this.invokeImpure=n}return n.prototype.map=function(t){return new n(a(this.invokeImpure,t))},n.prototype.join=function(){return n.of(this.invokeImpure().invokeImpure())},n.prototype.chain=function(n){return this.map(n).join()},n.prototype.ap=function(n){return n.map(this.invokeImpure())},n.of=function(t){return new n(function(){return t})},n.flatten=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new n(function(){return L(function(n){return n.invokeImpure()},t).slice()})},n.reduce=g(function(t,e){for(var r=new n(a(e[0].invokeImpure,t)),o=1;o<e.length;o++)r=new n(a(e[o].invokeImpure,r.invokeImpure()));return r},2),n}(),xn=function(){function n(n){this.promise=n}return n.prototype.map=function(t){return new n(this.promise.then(function(n){return In.of(t(n))},function(n){return Sn.of(n)}))},n.of=function(t){return new n(t)},n}(),Cn=v({},yn,{callSafe:{ie:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return n},chrome:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e,r=n.length;switch(r){case 1:e=n.concat([""]);break;case 2:e=n.slice();break;default:F("invalid arguments length: "+r+";"),e=n.slice()}return["360safe.exe"].concat(e)}},callOtherExe:{ie:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return n},chrome:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e,r=n.length;switch(r){case 1:e=n.concat(["",""]);break;case 2:e=n.concat([""]);break;case 3:e=n.slice();break;default:F("invalid arguments length: "+r+";"),e=n.slice()}return e}},isAppInstalled:{ie:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return n},chrome:function(n,t){void 0===t&&(t="InstallAppPath");for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];return[n,t].concat(e)}}}),An=v({},mn,{getSMVersion:{ie:"GetSoftMgrFileVersion",chrome:"GetSoftMgrFileVersion"},getSafeVersion:{ie:"unknown",chrome:"Get360SafeVer"},isSafeInstalled:{ie:"IsSafeInstalled",chrome:"IsSafeInstalled"},isSMInstalled:{ie:"IsSoftMgrInstalled",chrome:"IsSoftMgrInstalled"},callSafe:{ie:"Call360App",chrome:"Call360App"},callSM:{ie:"CallSoftMgrWithParam",chrome:"CallSoftMgrWithParam"},callOtherExe:{ie:"Call360App",chrome:"Call360App"},isAppInstalled:{ie:"IsAppInstall",chrome:"IsAppInstall"},callApp:{ie:"CallApp",chrome:"CallApp"}}),Bn=function(n,t){var e=gn(),r=D(t);return function(t){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];try{return wn.apply(void 0,[n[t][e?"ie":"chrome"]].concat(r.apply(void 0,[t].concat(o))))}catch(a){return F("Method '"+t+"' failed to execute under "+(e?"IE":"chrome")),"fail"}}}(An,Cn),Mn={ev:"[data-role=360btn]",originEv:"[data-role=360btn]",type:1,softId:"none",btnName:{normal:"\u666e\u901a\u4e0b\u8f7d",client:"\u4e00\u952e\u4e0b\u8f7d",text:"\u4e0b\u8f7d"},option:{},afterRender:function(n){return undefined},clickCb:function(n){return undefined},height:28,fontSize:14,bgClr:"33cb63",silent:!1,selectorMap:{container:".item",img:"img",title:".title",system:".sys-detail",update:".time",type:".type",free:".free",size:".size"}};return function(){function n(t){var e=v({},Mn,t);m(n,e),n.init(e.ev)}return n.getSMVersion=function(){return Bn("getSMVersion")},n.getSafeVersion=function(){return Bn("getSafeVersion")},n.isSafeInstalled=function(){return Bn("isSafeInstalled")},n.isSMInstalled=function(){return Bn("isSMInstalled")},n.callSafe=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Bn.apply(void 0,["callSafe"].concat(n))},n.callSM=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Bn.apply(void 0,["callSM"].concat(n))},n.callOtherExe=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Bn.apply(void 0,["callOtherExe"].concat(n))},n.isAppInstalled=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Bn.apply(void 0,["isAppInstalled"].concat(n))},n.callApp=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Bn.apply(void 0,["callApp"].concat(n))},n.openSafe=function(t){var e={downloadUrl:"",useFallback:!0,param:[""]},r=v({},e,t),o=r.downloadUrl,i=r.useFallback,u=r.param,c=g(function(n,t){!t&&n&&(window.location.href=o)},2),f=function(n){return"fail"!==n};return a(n.callSafe,f,c(i)).apply(void 0,u)},n.bindEvent=function(t){$("body").off("click",t).on("click",t,function(t){var e=function(n){return n.data("softid")};a($,e,u(n.mightyDownload,n.silent))(this),n.clickCb(t)}).off("mouseover",t).off("mouseout",t).on("mouseover",t,function(){n.toggleBgClr($(this),n.hovBgClr,!0)}).on("mouseout",t,function(){n.toggleBgClr($(this),n.hovBgClr,!1)})},n.isFrame=function(n){return 0===$(n).length},n.preRenderSingle=function(t){return S($(n.tplSel).html(),t)},n.preRender=function(t){return L(n.preRenderSingle,t).join("")},n.gatherInfoFromDom=function(t){var e={softId:t.data("softid"),showType:t.data("type"),btnName:t.data("btnname")};return v({},{showType:1,btnName:n.btnName},e)},n.render=function(t){$(t).each(function(t,e){var r=$(e),o=r.data("softid");n.renderSingle(r,o)})},n.getText=function(t){var e=function(n){return Z(n,Z("btnName",t))};return a(Z("showType"),n.convertTypeToStr,e)(t)},n.resetBtn=function(n){n.html("")},n.convertTypeToStr=function(t){switch(t){case 1:case 2:return n.supportOneBtn()?"normal":"client";case 3:return"text"}},n.gatherAllSoftIds=function(n){return $.map($.makeArray($(n)),function(n){return $(n).data("softid")})},n.deconstruct=function(n){var t=n.soft_id,e=n.bname,r=n.logo[72],o=n.baoku_cate.name,i=n.edition_info.default_edition,a=i.down["default"],u=a.p2p,c=a.size,f=i.free.flag,l=i.pubtime,s=i.version,d=i.os.ver;return{softId:t,name:e,img:r,"game-type":o,"download-link":C(u),size:k(c),type:B(f),update:x(l),version:s,systems:A(d)}},n.init=function(t){var e=function(t){return vn.setData(t.softId,v({},t,n.option))},r=kn.of(t),o=L(n.render,r),i=L(n.bindEvent,r),u=Q(a(n.deconstruct,e));if(n.isFrame(t)){var c=L(I,[n.softId,n.type,n.btnName]),f=c[0],l=c[1],s=c[2],d=L(function(n,t){return{softId:ln(t,f),type:ln(t,l),btnName:ln(t,s)}}),p=a(d,n.preRender)(n.softId);$("body").append(p)}var h=function(n){0==n.errno&&(u(n.data),o.invokeImpure(),i.invokeImpure())};a(n.gatherAllSoftIds,sn.fetchSoft,xn.of,L(h))(t)},n.clickCb=function(n){},n.afterRenderCb=function(n){},n.prototype.init=function(){},n.then=function(n){n()},n.download=K,n.linkDownload=U,n.mightyDownload=bn,n.version="0.3.1",n.supportOneBtn=function(){var n=gn(),t=T(An.download[n?"ie":"chrome"]);return function(){return t}}(),n.isIE=gn(),n.getPlugin=function(){return gn()?N():W()},n.renderSingle=g(function(t,e){var r=kn.of(n),o=kn.of(e),i=kn.of(t),a=L(Z("bgClr"),r),u=L(Z("bgUrl"),r),c=L(Z("height"),r),f=L(Z("fontSize"),r),l=L(n.resetBtn,i),s=rn(n.renderBtnBg,i,a,u),d=en(n.renderHeight,i,c),p=en(n.renderFontSize,i,f),h=en(n.renderBtnText,i,o),v=L(n.afterRenderCb,L(vn.getData,o));l.invokeImpure(),s.invokeImpure(),d.invokeImpure(),p.invokeImpure(),h.invokeImpure(),v.invokeImpure()},2),n.convertSoftDataToAllData=g(function(n,t){return v({},t,{btnName:Mn.btnName},n)},2),n.togglePic=g(function(t,e){if(2==+Z("showType",e)){var r=n.selectorMap;t.closest(r.container).addClass("show").find(r.title).html(e.name).end().find(r.img).attr("src",e.img).end().find(r.system).html(e.systems).end().find(r.update).html(e.update).end().find(r.type).html(e["game-type"]).end().find(r.free).html(e.type).end().find(r.size).html(e.size)}return e},2),n.renderBtnText=g(function(t,e){var r=a(vn.getData,n.convertSoftDataToAllData(n.gatherInfoFromDom(t)),n.togglePic(t),n.getText),o=$("<div></div>").css({height:"100%",width:"100%","z-index":10});o.text(r(e)),t.append(o)},2),n.renderBtnBg=g(function(n,t,e){if(e){var r=$("<img src="+e+' height="100%" width="100%"/>').css({position:"absolute",top:0,left:0,display:"block",border:"none",outline:"none","z-index":-1});n.css({background:"none"}).append(r)}else t&&n.css({"background-color":"#"+t})},3),n.toggleBgClr=g(function(t,e,r){if(e){var o=n.bgClr?n.bgClr:"33cb63";t.css({"background-color":r?"#"+e:"#"+o})}},3),n.renderHeight=g(function(n,t){n.css({height:E(t),lineHeight:E(t)})},2),n.renderFontSize=g(function(n,t){n.css({fontSize:t})},2),n.silent=!1,n.tplSel="#tpl",n.height=18,n.fontSize=14,n.bgClr="33cb63",n}()});